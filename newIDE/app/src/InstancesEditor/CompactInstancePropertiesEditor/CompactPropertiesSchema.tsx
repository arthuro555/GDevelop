import * as React from 'react';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '@lingui/core'. '/home/arthuro555/code/GDevelop/newIDE/app/node_modules/@lingui/core/index.js' implicitly has an 'any' type.
import { I18n as I18nType } from '@lingui/core';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '@lingui/macro'. '/home/arthuro555/code/GDevelop/newIDE/app/node_modules/@lingui/macro/index.js' implicitly has an 'any' type.
import { t } from '@lingui/macro';

// @ts-expect-error - TS6142 - Module '../../CompactPropertiesEditor' was resolved to '/home/arthuro555/code/GDevelop/newIDE/app/src/CompactPropertiesEditor/index.tsx', but '--jsx' is not set.
import { Schema, SectionTitle } from '../../CompactPropertiesEditor';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../LayersList/EnumerateLayers'. '/home/arthuro555/code/GDevelop/newIDE/app/src/LayersList/EnumerateLayers.js' implicitly has an 'any' type.
import enumerateLayers from '../../LayersList/EnumerateLayers';
// @ts-expect-error - TS6142 - Module '.' was resolved to '/home/arthuro555/code/GDevelop/newIDE/app/src/InstancesEditor/CompactInstancePropertiesEditor/index.tsx', but '--jsx' is not set.
import { styles } from '.';

// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Layers'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Layers.js' implicitly has an 'any' type.
import Layers from '../../UI/CustomSvgIcons/Layers';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/LetterX'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/LetterX.js' implicitly has an 'any' type.
import LetterX from '../../UI/CustomSvgIcons/LetterX';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/LetterY'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/LetterY.js' implicitly has an 'any' type.
import LetterY from '../../UI/CustomSvgIcons/LetterY';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/LetterH'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/LetterH.js' implicitly has an 'any' type.
import LetterH from '../../UI/CustomSvgIcons/LetterH';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/LetterW'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/LetterW.js' implicitly has an 'any' type.
import LetterW from '../../UI/CustomSvgIcons/LetterW';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/LetterD'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/LetterD.js' implicitly has an 'any' type.
import LetterD from '../../UI/CustomSvgIcons/LetterD';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/LetterZ'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/LetterZ.js' implicitly has an 'any' type.
import LetterZ from '../../UI/CustomSvgIcons/LetterZ';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Instance'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Instance.js' implicitly has an 'any' type.
import Instance from '../../UI/CustomSvgIcons/Instance';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Link'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Link.js' implicitly has an 'any' type.
import Link from '../../UI/CustomSvgIcons/Link';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Unlink'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Unlink.js' implicitly has an 'any' type.
import Unlink from '../../UI/CustomSvgIcons/Unlink';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/RemoveCircle'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/RemoveCircle.js' implicitly has an 'any' type.
import RemoveCircle from '../../UI/CustomSvgIcons/RemoveCircle';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Lock'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Lock.js' implicitly has an 'any' type.
import Lock from '../../UI/CustomSvgIcons/Lock';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/LockOpen'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/LockOpen.js' implicitly has an 'any' type.
import LockOpen from '../../UI/CustomSvgIcons/LockOpen';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Restore'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Restore.js' implicitly has an 'any' type.
import Restore from '../../UI/CustomSvgIcons/Restore';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Object3d'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Object3d.js' implicitly has an 'any' type.
import Object3d from '../../UI/CustomSvgIcons/Object3d';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/Object2d'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/Object2d.js' implicitly has an 'any' type.
import Object2d from '../../UI/CustomSvgIcons/Object2d';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/RotateX'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/RotateX.js' implicitly has an 'any' type.
import RotateX from '../../UI/CustomSvgIcons/RotateX';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/RotateY'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/RotateY.js' implicitly has an 'any' type.
import RotateY from '../../UI/CustomSvgIcons/RotateY';
// @ts-expect-error - TS7016 - Could not find a declaration file for module '../../UI/CustomSvgIcons/RotateZ'. '/home/arthuro555/code/GDevelop/newIDE/app/src/UI/CustomSvgIcons/RotateZ.js' implicitly has an 'any' type.
import RotateZ from '../../UI/CustomSvgIcons/RotateZ';

/**
 * Applies ratio to value without intermediary value to avoid precision issues.
 */
const applyRatio = ({
  oldReferenceValue,
  newReferenceValue,
  valueToApplyTo,
}: {
  oldReferenceValue: number,
  newReferenceValue: number,
  valueToApplyTo: number
}) => {
  return (newReferenceValue / oldReferenceValue) * valueToApplyTo;
};

const getEditObjectButton = ({
  i18n,
  onEditObjectByName,
  is3DInstance,
}: {
  i18n: I18nType,
  onEditObjectByName: (name: string) => void,
  is3DInstance: boolean
}) => ({
  label: i18n._(t`Edit object`),
  disabled: 'onValuesDifferent',
  nonFieldType: 'button',
  getIcon: is3DInstance
    ? props: {
// @ts-expect-error - TS2693 - 'string' only refers to a type, but is being used as a value here.
    fontSize: string
  } => <Object3d {...props} />
// @ts-expect-error - TS1128 - Declaration or statement expected.
    : props: {
// @ts-expect-error - TS2693 - 'string' only refers to a type, but is being used as a value here.
    fontSize: string
  } => <Object2d {...props} />,
  getValue: (instance: gdInitialInstance) => instance.getObjectName(),
  onClick: (instance: gdInitialInstance) =>
    onEditObjectByName(instance.getObjectName()),
// @ts-expect-error - TS1109 - Expression expected. | TS1128 - Declaration or statement expected.
});

const getRotationXAndRotationYFields = ({
  i18n,
}: {
  i18n: I18nType
}) => [
  {
    name: 'Rotation X',
    getLabel: () => i18n._(t`Rotation (X)`),
    valueType: 'number',
    getValue: (instance: gdInitialInstance) => instance.getRotationX(),
    setValue: (instance: gdInitialInstance, newValue: number) =>
      instance.setRotationX(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
    renderLeftIcon: className => <RotateX className={className} />,
  },
  {
    name: 'Rotation Y',
    getLabel: () => i18n._(t`Rotation (Y)`),
    valueType: 'number',
    getValue: (instance: gdInitialInstance) => instance.getRotationY(),
    setValue: (instance: gdInitialInstance, newValue: number) =>
      instance.setRotationY(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
    renderLeftIcon: className => <RotateY className={className} />,
  },
];
const getRotationZField = ({
  i18n,
}: {
  i18n: I18nType
}) => ({
  name: 'Angle',
  getLabel: () => i18n._(t`Rotation (Z)`),
  valueType: 'number',
  getValue: (instance: gdInitialInstance) => instance.getAngle(),
  setValue: (instance: gdInitialInstance, newValue: number) =>
    instance.setAngle(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  renderLeftIcon: className => <RotateZ className={className} />,
});
const getXAndYFields = (
  {
    i18n,
  }: {
    i18n: I18nType
  },
): Schema => [
  {
    name: 'X',
    getLabel: () => i18n._(t`X`),
    valueType: 'number',
    getValue: (instance: gdInitialInstance) => instance.getX(),
    setValue: (instance: gdInitialInstance, newValue: number) =>
      instance.setX(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
    renderLeftIcon: className => <LetterX className={className} />,
  },
  {
    name: 'Y',
    getLabel: () => i18n._(t`Y`),
    valueType: 'number',
    getValue: (instance: gdInitialInstance) => instance.getY(),
    setValue: (instance: gdInitialInstance, newValue: number) =>
      instance.setY(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
    renderLeftIcon: className => <LetterY className={className} />,
  },
];
const getZField = ({
  i18n,
}: {
  i18n: I18nType
}) => ({
  name: 'Z',
  getLabel: () => i18n._(t`Z`),
  valueType: 'number',
  getValue: (instance: gdInitialInstance) => instance.getZ(),
  setValue: (instance: gdInitialInstance, newValue: number) =>
    instance.setZ(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  renderLeftIcon: className => <LetterZ className={className} />,
});
const getLayerField = ({
  i18n,
  layout,
}: {
  i18n: I18nType,
  layout: gdLayout
}) => ({
  name: 'Layer',
  getLabel: () => i18n._(t`Layer`),
  valueType: 'string',
  getChoices: () => enumerateLayers(layout),
  getValue: (instance: gdInitialInstance) => instance.getLayer(),
  setValue: (instance: gdInitialInstance, newValue: string) =>
    instance.setLayer(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  renderLeftIcon: className => <Layers className={className} />,
});
const getZOrderField = ({
  i18n,
}: {
  i18n: I18nType
}) => ({
  name: 'Z Order',
  getLabel: () => i18n._(t`Z Order`),
  valueType: 'number',
  getValue: (instance: gdInitialInstance) => instance.getZOrder(),
  setValue: (instance: gdInitialInstance, newValue: number) =>
    instance.setZOrder(newValue),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  renderLeftIcon: className => <LetterZ className={className} />,
});

const getTitleRow = ({
  i18n,
}: {
  i18n: I18nType
}) => ({
  name: 'Title',
  type: 'row',
  preventWrap: true,
  children: [
    {
      name: 'Instance',
      title: i18n._(t`Instance`),
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type.
      renderLeftIcon: className => (
// @ts-expect-error - TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
        <Instance className={className} style={styles.icon} />
      ),
      getValue: (instance: gdInitialInstance) => instance.getObjectName(),
      nonFieldType: 'title',
      defaultValue: i18n._(t`Different objects`),
    },
    {
      name: 'Lock instance',
      getLabel: (instance: gdInitialInstance) =>
        instance.isSealed()
          ? i18n._(t`Free instance`)
          : instance.isLocked()
          ? i18n._(t`Prevent selection in the editor`)
          : i18n._(t`Lock position/angle in the editor`),
      valueType: 'enumIcon',
// @ts-expect-error - TS7006 - Parameter 'value' implicitly has an 'any' type.
      renderIcon: value =>
        value === 'sealed' ? (
// @ts-expect-error - TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
          <RemoveCircle style={styles.icon} />
        ) : value === 'locked' ? (
// @ts-expect-error - TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
          <Lock style={styles.icon} />
        ) : (
// @ts-expect-error - TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
          <LockOpen style={styles.icon} />
        ),
// @ts-expect-error - TS7006 - Parameter 'value' implicitly has an 'any' type.
      isHighlighted: value => value === 'locked' || value === 'sealed',
      getValue: (instance: gdInitialInstance) =>
        instance.isSealed()
          ? 'sealed'
          : instance.isLocked()
          ? 'locked'
          : 'free',
      setValue: (instance: gdInitialInstance, newValue: boolean) => {
        if (instance.isSealed()) {
          instance.setSealed(false);
          instance.setLocked(false);
          return;
        }
        if (instance.isLocked()) {
          instance.setSealed(true);
          return;
        }
        instance.setLocked(true);
      },
    },
  ],
});

const getWidthField = ({
  i18n,
  getInstanceWidth,
  getInstanceHeight,
  getInstanceDepth,
  forceUpdate,
}: {
  i18n: I18nType,
  getInstanceWidth: (arg1: gdInitialInstance) => number,
  getInstanceHeight: (arg1: gdInitialInstance) => number,
  getInstanceDepth: (arg1: gdInitialInstance) => number,
  forceUpdate: () => void
}) => ({
  name: 'Width',
  getLabel: () => i18n._(t`Width`),
  valueType: 'number',
  getValue: getInstanceWidth,
  setValue: (instance: gdInitialInstance, newValue: number) => {
    const shouldKeepRatio = instance.shouldKeepRatio();
    const newWidth = Math.max(newValue, 0);
    if (shouldKeepRatio) {
      const initialWidth = getInstanceWidth(instance) || 1;
      instance.setCustomWidth(newWidth);
      instance.setCustomHeight(
        applyRatio({
          oldReferenceValue: initialWidth,
          newReferenceValue: newWidth,
          valueToApplyTo: getInstanceHeight(instance),
        })
      );
      instance.setCustomDepth(
        applyRatio({
          oldReferenceValue: initialWidth,
          newReferenceValue: newWidth,
          valueToApplyTo: getInstanceDepth(instance),
        })
      );
    } else {
      instance.setCustomWidth(newWidth);
      instance.setCustomHeight(getInstanceHeight(instance));
      instance.setCustomDepth(getInstanceDepth(instance));
    }

    // This must be done after reading the size.
    instance.setHasCustomSize(true);
    instance.setHasCustomDepth(true);
    forceUpdate();
  },
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  renderLeftIcon: className => <LetterW className={className} />,
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  getEndAdornmentIcon: className => <Restore className={className} />,
  onClickEndAdornment: (instance: gdInitialInstance) => {
    instance.setHasCustomSize(false);
    instance.setHasCustomDepth(false);
    forceUpdate();
  },
});
const getHeightField = ({
  i18n,
  getInstanceWidth,
  getInstanceHeight,
  getInstanceDepth,
  forceUpdate,
}: {
  i18n: I18nType,
  getInstanceWidth: (arg1: gdInitialInstance) => number,
  getInstanceHeight: (arg1: gdInitialInstance) => number,
  getInstanceDepth: (arg1: gdInitialInstance) => number,
  forceUpdate: () => void
}) => ({
  name: 'Height',
  getLabel: () => i18n._(t`Height`),
  valueType: 'number',
  getValue: getInstanceHeight,
  setValue: (instance: gdInitialInstance, newValue: number) => {
    const shouldKeepRatio = instance.shouldKeepRatio();
    const newHeight = Math.max(newValue, 0);
    if (shouldKeepRatio) {
      const initialHeight = getInstanceHeight(instance) || 1;
      instance.setCustomWidth(
        applyRatio({
          oldReferenceValue: initialHeight,
          newReferenceValue: newHeight,
          valueToApplyTo: getInstanceWidth(instance),
        })
      );
      instance.setCustomHeight(newHeight);
      instance.setCustomDepth(
        applyRatio({
          oldReferenceValue: initialHeight,
          newReferenceValue: newHeight,
          valueToApplyTo: getInstanceDepth(instance),
        })
      );
    } else {
      instance.setCustomWidth(getInstanceWidth(instance));
      instance.setCustomHeight(newHeight);
      instance.setCustomDepth(getInstanceDepth(instance));
    }

    // This must be done after reading the size.
    instance.setHasCustomSize(true);
    instance.setHasCustomDepth(true);
    forceUpdate();
  },
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  renderLeftIcon: className => <LetterH className={className} />,
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  getEndAdornmentIcon: className => <Restore className={className} />,
  onClickEndAdornment: (instance: gdInitialInstance) => {
    instance.setHasCustomSize(false);
    instance.setHasCustomDepth(false);
    forceUpdate();
  },
});
const getDepthField = ({
  i18n,
  getInstanceWidth,
  getInstanceHeight,
  getInstanceDepth,
  forceUpdate,
}: {
  i18n: I18nType,
  getInstanceWidth: (arg1: gdInitialInstance) => number,
  getInstanceHeight: (arg1: gdInitialInstance) => number,
  getInstanceDepth: (arg1: gdInitialInstance) => number,
  forceUpdate: () => void
}) => ({
  name: 'Depth',
  getLabel: () => i18n._(t`Depth`),
  valueType: 'number',
  getValue: getInstanceDepth,
  setValue: (instance: gdInitialInstance, newValue: number) => {
    const shouldKeepRatio = instance.shouldKeepRatio();
    const newDepth = Math.max(newValue, 0);
    if (shouldKeepRatio) {
      const initialDepth = getInstanceDepth(instance) || 1;
      instance.setCustomWidth(
        applyRatio({
          oldReferenceValue: initialDepth,
          newReferenceValue: newDepth,
          valueToApplyTo: getInstanceWidth(instance),
        })
      );
      instance.setCustomHeight(
        applyRatio({
          oldReferenceValue: initialDepth,
          newReferenceValue: newDepth,
          valueToApplyTo: getInstanceHeight(instance),
        })
      );
      instance.setCustomDepth(newDepth);
    } else {
      instance.setCustomWidth(getInstanceWidth(instance));
      instance.setCustomHeight(getInstanceHeight(instance));
      instance.setCustomDepth(newDepth);
    }

    // This must be done after reading the size.
    instance.setHasCustomSize(true);
    instance.setHasCustomDepth(true);
    forceUpdate();
  },
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  renderLeftIcon: className => <LetterD className={className} />,
// @ts-expect-error - TS7006 - Parameter 'className' implicitly has an 'any' type. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
  getEndAdornmentIcon: className => <Restore className={className} />,
  onClickEndAdornment: (instance: gdInitialInstance) => {
    instance.setHasCustomSize(false);
    instance.setHasCustomDepth(false);
    forceUpdate();
  },
});
const getKeepRatioField = ({
  i18n,
  getInstanceWidth,
  getInstanceHeight,
  getInstanceDepth,
  forceUpdate,
}: {
  i18n: I18nType,
  getInstanceWidth: (arg1: gdInitialInstance) => number,
  getInstanceHeight: (arg1: gdInitialInstance) => number,
  getInstanceDepth: (arg1: gdInitialInstance) => number,
  forceUpdate: () => void
}) => ({
  name: 'Keep ratio',
  getLabel: () => i18n._(t`Keep ratio`),
  valueType: 'enumIcon',
// @ts-expect-error - TS7006 - Parameter 'value' implicitly has an 'any' type.
  isHighlighted: value => value,
// @ts-expect-error - TS7006 - Parameter 'value' implicitly has an 'any' type.
  renderIcon: value =>
// @ts-expect-error - TS17004 - Cannot use JSX unless the '--jsx' flag is provided. | TS17004 - Cannot use JSX unless the '--jsx' flag is provided.
    value ? <Link style={styles.icon} /> : <Unlink style={styles.icon} />,
  getValue: (instance: gdInitialInstance) => instance.shouldKeepRatio(),
  setValue: (instance: gdInitialInstance, newValue: boolean) =>
    instance.setShouldKeepRatio(newValue),
});

export const makeSchema = (
  {
    is3DInstance,
    i18n,
    forceUpdate,
    onEditObjectByName,
    onGetInstanceSize,
    layout,
  }: {
    is3DInstance: boolean,
    i18n: I18nType,
    forceUpdate: () => void,
    onEditObjectByName: (name: string) => void,
    onGetInstanceSize: (arg1: gdInitialInstance) => [number, number, number],
    layout: gdLayout
  },
): Schema => {
  const getInstanceWidth = (instance: gdInitialInstance) =>
    instance.hasCustomSize()
      ? instance.getCustomWidth()
      : onGetInstanceSize(instance)[0];

  const getInstanceHeight = (instance: gdInitialInstance) =>
    instance.hasCustomSize()
      ? instance.getCustomHeight()
      : onGetInstanceSize(instance)[1];

  const getInstanceDepth = (instance: gdInitialInstance) =>
    instance.hasCustomDepth()
      ? instance.getCustomDepth()
      : onGetInstanceSize(instance)[2];

  if (is3DInstance) {
    return [
      getTitleRow({ i18n }),
      getEditObjectButton({ i18n, onEditObjectByName, is3DInstance }),
      {
        name: 'Position',
        type: 'row',
        preventWrap: true,
        removeSpacers: true,
        children: [...getXAndYFields({ i18n }), getZField({ i18n })],
      },
      {
        name: 'Size',
        type: 'row',
        preventWrap: true,
        children: [
          {
            name: 'Custom size',
            type: 'column',
            children: [
              getWidthField({
                i18n,
                getInstanceWidth,
                getInstanceHeight,
                getInstanceDepth,
                forceUpdate,
              }),
              getHeightField({
                i18n,
                getInstanceWidth,
                getInstanceHeight,
                getInstanceDepth,
                forceUpdate,
              }),
              getDepthField({
                i18n,
                getInstanceWidth,
                getInstanceHeight,
                getInstanceDepth,
                forceUpdate,
              }),
            ],
          },
          {
            name: 'Keep ratio column',
            nonFieldType: 'verticalCenterWithBar',
            child: getKeepRatioField({
              i18n,
              getInstanceWidth,
              getInstanceHeight,
              getInstanceDepth,
              forceUpdate,
            }),
          },
        ],
      },
      getLayerField({ i18n, layout }),
      {
        name: 'Rotation',
        type: 'row',
        title: i18n._(t`Rotation`),
        preventWrap: true,
        removeSpacers: true,
        children: getRotationXAndRotationYFields({ i18n }),
      },
      getRotationZField({ i18n }),
    ];
  }

  return [
    getTitleRow({ i18n }),
    getEditObjectButton({ i18n, onEditObjectByName, is3DInstance }),
    {
      name: 'Position',
      type: 'row',
      preventWrap: true,
      removeSpacers: true,
      children: getXAndYFields({ i18n }),
    },
    getZOrderField({ i18n }),
    {
      name: 'Size',
      type: 'row',
      preventWrap: true,
      children: [
        {
          name: 'Custom size',
          type: 'column',
          children: [
            getWidthField({
              i18n,
              getInstanceWidth,
              getInstanceHeight,
              getInstanceDepth,
              forceUpdate,
            }),
            getHeightField({
              i18n,
              getInstanceWidth,
              getInstanceHeight,
              getInstanceDepth,
              forceUpdate,
            }),
          ],
        },
        {
          name: 'Keep ratio column',
          nonFieldType: 'verticalCenterWithBar',
          child: getKeepRatioField({
            i18n,
            getInstanceWidth,
            getInstanceHeight,
            getInstanceDepth,
            forceUpdate,
          }),
        },
      ],
    },
    getLayerField({ i18n, layout }),
    {
      name: 'Rotation',
      type: 'row',
      title: i18n._(t`Rotation`),
      preventWrap: true,
      removeSpacers: true,
      children: [getRotationZField({ i18n })],
    },
  ];
};

export const reorderInstanceSchemaForCustomProperties = (schema: Schema, i18n: I18nType): Schema => {
  const newSchema = [...schema];
  const animationFieldIndex = newSchema.findIndex(
    field => field.name && field.name === 'animation'
  );
  const contentSectionTitle: SectionTitle = {
    nonFieldType: 'sectionTitle',
    name: 'Content',
    title: 'Content',
    getValue: undefined,
  };
  if (animationFieldIndex === -1) {
    if (newSchema.length > 0) {
      newSchema.unshift(contentSectionTitle);
    }
    return newSchema;
  }

  const [animationField] = newSchema.splice(animationFieldIndex, 1);

  const firstFields: Schema = [
    {
      name: 'Animation',
      type: 'row',
      title: i18n._(t`Animation`),
      // $FlowIgnore - We are confident the animation field is not a row or a column.
      children: [{ ...animationField, hideLabel: true }],
    },
  ];
  if (newSchema.length > 0) {
    firstFields.push(contentSectionTitle);
  }
  newSchema.unshift(...firstFields);
  return newSchema;
};
